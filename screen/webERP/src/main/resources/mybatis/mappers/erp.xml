<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper
      PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
   "http://mybatis.org/dtd/mybatis-3-mapper.dtd">

<mapper namespace="mappers.erp">
	<resultMap id="SmBimResult"
		type="CommitOperationInstructionVO">
		<result property="itemCode" column="Item_Code" />
		<result property="itemName" column="Item_Name" />
		<result property="standard" column="Standard" />
		<result property="inventoryUnit" column="Inventory_Unit" />
		<result property="dailyProduction" column="DailyProduction" />
	</resultMap>
	<resultMap id="OpePerRegResult" type="OperationRegistVO">
		<result property="workOrderNumber" column="workOrderNumber" />
		<result property="instructionDate" column="InstructionDate" />
		<result property="dueDate" column="dueDate" />
		<result property="itemCode" column="Item_Code" />
		<result property="itemName" column="Item_Name" />
		<result property="standard" column="Standard" />
		<result property="inventoryUnit" column="Inventory_Unit" />
		<result property="indicated" column="IndicatedQuantity" />
		<result property="status" column="status" />
		<result property="inspection" column="Inspection" />
		<result property="note" column="note" />
	</resultMap>
	<resultMap id="FactoryViewResult" type="FactoryViewVO">
		<result property="workplaceCode" column="workplace_Code" />
		<result property="workplaceName" column="workplace_Name" />
	</resultMap>
	<select id="selectAllProductionPlanInfo" resultMap="SmBimResult">
		<![CDATA[select Item_Code, Item_Name, Standard, Inventory_Unit, DailyProduction from SM_BIM_Ite_Reg]]>
	</select>
	<select id="selectAllOperationRegistInfo" resultMap="OpePerRegResult">
		<![CDATA[select * from CPM_PM_Ope_Per_Reg]]>
	</select>
	
	<select id="selectFactoryList" resultMap="FactoryViewResult">
		<![CDATA[select * from SM_CRI_Wor_Reg]]>
	</select>
	<!-- BOM 파트 -->
	<resultMap id="bomView" type="bomVO">
		<result property="no" column="no" />
		<result property="itemNumber" column="item_code" />
		<result property="itemName" column="item_name" />
		<result property="standard" column="standard" />
		<result property="unit" column="invenvtory_unit" />
		<result property="precisionQuantity" column="precisionQuantity" />
		<result property="loss" column="loss" />
		<result property="actualCost" column="actualCost" />
		<result property="outSourcingUnitPrice"
			column="outSourcingUnitPrice" />
		<result property="startDate" column="startDate" />
		<result property="endDate" column="endDate" />
		<result property="note" column="note" />
	</resultMap>
	<resultMap id="popView" type="bomVO">
		<result property="itemNumber" column="item_code" />
		<result property="itemName" column="item_name" />
		<result property="standard" column="standard" />
	</resultMap>

	<select id="selectAllMemberList" resultMap="bomView">
		<![CDATA[select * from CPM_BIM_BOM_REG]]>
	</select>
	<select id="searchitem" resultMap="bomView"
		parameterType="String">
		<![CDATA[select * from CPM_BIM_BOM_REG where item_code = #{itemNumber}]]>
	</select>
	<select id="selectitem" resultMap="bomView"
		parameterType="String">
		<![CDATA[select item_code,item_name,standard,inventory_unit from CPM_BIM_BOM_REG where item_code=#{itemNumber}]]>
	</select>
	<select id="selectPopList" resultMap="popView">
		<![CDATA[select * from CPM_BIM_BOM_REG]]>
	</select>
	<insert id="insertBOM" parameterType="bomVO">
		<![CDATA[
		 insert into CPM_BIM_BOM_REG
		 values(#{no}, #{itemNumber}, #{itemName}, #{standard}, #{unit}, #{precisionQuantity}, #{loss}, #{actualQuantity}, #{actualCost}, #{outSourcingUnitPrice}, #{startDate}, #{endDate}, #{note})
		]]>  
	</insert>
	<!-- 
		<update id="updateBOM" parameterType="bomVO">
		<![CDATA[
		update CPM_BIM_BOM_REG
		set no=#{no}, item_name=#{itemName}, standard=#{standard}, inventory_unit=#{unit},precisionQuantity=#{precisionQuantity}, loss=#{loss},actualCost=#{actualCost}, outSourcingUnitPrice=#{outSourcingUnitPrice}, startDate=#{startDate}, endDate=#{endDate}, note=#{note}
		where  item_code=#{itemNumber}
		]]>  
	</update>
	-->
	<update id="updateBOM" parameterType="bomVO">
		<![CDATA[
		update CPM_BIM_BOM_REG
		set item_name=#{itemName}
		where  item_code=#{itemNumber}
		]]>  
	</update>
	
<!-- 구매관리파트 -->
	<!-- mainPaln 주계획 -->
	<resultMap id="mainplanResult" type="mainplanVO">
		<result property="planNO" column="planNO" />
		<result property="plandate" column="plandate" />
		<result property="item_Code" column="item_Code" />
		<result property="item_Name" column="item_Name" />
		<result property="standard" column="standard" />
		<result property="inventory_unit" column="inventory_unit" />
		<result property="sequence" column="sequence" />
		<result property="expected_date" column="expected_date" />
		<result property="due_date" column="due_date" />
		<result property="plan_quantity" column="plan_quantity" />
		<result property="buyer" column="buyer" />
		<result property="note" column="note" />
		<result property="startDate" column="startDate" />
		<result property="endDate" column="endDate" />
	</resultMap>
	<resultMap type="mpsosVO" id="MpsOSResult">
		<result column="orderno" property="orderno" />
		<result column="sequence" property="sequence" />
		<result column="orderdate" property="orderdate" />
		<result column="buyer" property="buyer" />
		<result column="item_Code" property="item_Code" />
		<result column="item_Name" property="item_Name" />
		<result column="standard" property="standard" />
		<result column="inventory_unit" property="inventory_unit" />
		<result column="order_quantity" property="order_quantity" />
		<result column="expected_Date" property="expected_Date" />
		<result column="note" property="note" />
	</resultMap>

	<select id="selectAllMainPlanList" resultMap="mainplanResult" parameterType="MainPlanVO"> 
		<![CDATA[SELECT * from pmm_pm_mps]]><!-- 
	select cc.Item_Code, cc.Item_Name, cc.standard, cc.Inventory_Unit,
	cc.dueDate, cc.releaseExpectedDate,
	mp.plandate, mp.plan_Quantity, mp.buyer
	from CSM_SM_COR_Reg cc, PMM_PM_MPS mp
	where cc.dueDate = mp.plandate -->
	<where>
		<if test="startDate != '' and startDate != null">plandate between #{startDate} and #{endDate} </if>
		<if test="endDate != '' and endDate != null">and due_date between #{startDate} and #{endDate} </if>
	</where>
	</select>
 	<delete id="deleteMps">
		delete from pmm_pm_mps where sequence = #{sequence}
	</delete>
	<select id="selectAllMpsosList" resultMap="MpsOSResult" parameterType="MainPlanVO">
		<![CDATA[SELECT * from pmm_pm_mps_os]]><!-- 
	select co.ordersNum, co.ordersdate, co.customerCode, co.Note,
	cc.Item_Code, cc.Item_Name, cc.standard, cc.Inventory_Unit,
	cc.releaseExpectedDate
	from CSM_SM_Ord_Reg co, CSM_SM_COR_Reg cc -->
	<where>
		<if test="startDate != '' and startDate != null">orderdate between #{startDate} and #{endDate} </if>
		<if test="endDate != '' and endDate != null">and okeydate between #{startDate} and #{endDate} </if>
	</where>
	</select>
	<update id="updateMPS" >
		<![CDATA[update pmm_pm_mps
			set  plandate=#{plandate},due_date=#{due_date},plan_quantity=#{plan_quantity},note=#{note}
			where sequence = #{sequence}]]>  
	</update>
	<insert id="insertMPS" parameterType="MainPlanVO">
		<![CDATA[insert into pmm_pm_mps
			values(F_GET_NEXT_SEQ('PMM_PM_MPS'),#{plandate},#{item_Code},#{item_Name},#{standard},#{inventory_unit},#{sequence},
			#{expected_date}, #{due_date}, #{plan_quantity}, #{buyer}, #{note})
		]]>
	</insert>
	<!-- billing 청구등록 -->
	<resultMap id="billingResult" type="billingVO">
 		<result property="sequence" column="sequence" />
		<result property="claim_no" column="claim_no" />
		<result property="claim_date" column="claim_date" />
		<result property="claim_division" column="claim_division" />
		<result column="item_Code" property="item_Code" />
		<result column="item_Name" property="item_Name" />
		<result column="standard" property="standard" />
		<result column="requestdate" property="requestdate" />
		<result column="inventory_qty" property="inventory_qty" />
		<result column="claim_quantity" property="claim_quantity" />
		<result column="buyer" property="buyer" />		
		<result property="note" column="note" />
	</resultMap>
	<resultMap id="mrpamountResult" type="requiredamountVO">
		<result property="need_date" column="need_date" />
		<result property="expected_order" column="expected_order" />
		<result property="item_Code" column="item_Code" />
		<result property="item_Name" column="item_Name" />
		<result property="standard" column="standard" />
		<result property="inventory_unit" column="inventory_unit" />
		<result property="expected_quantity" column="expected_quantity" />
	</resultMap>

	<select id="selectAllcmList" resultMap="billingResult" parameterType="MainPlanVO">
		<![CDATA[SELECT * from PMM_PM_CM]]>
	<where>
		<if test="startDate != '' and startDate != null">claim_date between #{startDate} and #{endDate} </if>
		<if test="endDate != '' and endDate != null">and requestdate between #{startDate} and #{endDate} </if>
	</where>
	</select>	
	<select id="selectAllMrpaMount" resultMap="mrpamountResult">
		<![CDATA[select need_date,expected_order,item_Code,item_Name,standard,inventory_unit,expected_quantity
			from pmm_pm_mrp]]>
	</select>
 	<delete id="delbilling">
		delete from PMM_PM_CM where sequence = #{sequence}
	</delete>
	<update id="updatebilling" >
		<![CDATA[update PMM_PM_CM
			set claim_division=#{claim_division},requestdate=#{requestdate},inventory_qty=#{inventory_qty},
			claim_quantity=#{claim_quantity},buyer=#{buyer},note=#{note}
			where sequence = #{sequence}]]>  
	</update>
 	<insert id="insertbilling" parameterType="billingVO">
		<![CDATA[insert into PMM_PM_CM
		values(F_GET_NEXT_SEQ('SEQ'),F_GET_NEXT_SEQ('PMM_PM_CM'),#{claim_date},#{claim_division},#{item_Code},#{item_Name},#{standard},#{requestdate},
		#{inventory_qty},#{claim_quantity},#{buyer},#{note})
		]]>
	</insert> 

	<!-- mrp 소요량 -->
	<resultMap id="mrpResult" type="requiredamountVO">
		<result property="sequence" column="sequence" />
		<result property="expected_order" column="expected_order" />
		<collection property="bomVO" resultMap="bomView"/>
		<collection property="mainplanVO" resultMap="mainplanResult"/>
	</resultMap>

	<select id="selectAllMrpList" resultMap="mrpResult" parameterType="java.util.HashMap">
		<![CDATA[select bom.item_code, bom.item_name, bom.standard, bom.precisionQuantity, bom.inventory_unit,
			pm.due_date, pm.sequence , mr.expected_order
    		from CPM_BIM_BOM_REG bom, pmm_pm_mps pm, pmm_pm_mrp mr
            where pm.sequence = bom.no 
            and pm.sequence = mr.sequence
    		    ]]>
	<where>
		<if test="startDate != '' and startDate != null">due_date between #{startDate} and #{endDate} </if>
		<if test="endDate != '' and endDate != null">and due_date between #{startDate} and #{endDate} </if>
	</where>
	</select>
	<update id="updateMRP" >
		<![CDATA[update pmm_pm_mrp
			set expected_quantity =#{expected_quantity}
			where sequence = #{sequence}]]>  
	</update>
	
	<!-- orderclosing 발주마감 -->
	<resultMap id="orderclosingResult" type="orderclosingVO">
		<result property="sequence" column="sequence" />
		<result property="order_no" column="order_no" />
		<result property="order_date" column="order_date" />
		<result property="code" column="code" />
		<result property="buyer" column="buyer" />
		<result property="item_Code" column="item_Code" />
		<result property="item_Name" column="item_Name" />
		<result property="standard" column="standard" />
		<result property="inventory_unit" column="inventory_unit" />
		<result property="order_quantity" column="order_quantity" />
		<result property="price" column="price" />
		<result property="deadline" column="deadline" />
	</resultMap>
	
	<select id="selectAllClosingList" resultMap="orderclosingResult">
		<![CDATA[select sequence,order_no,order_date,code,buyer,item_Code,item_Name,standard,
		inventory_unit,order_quantity,price, order_quantity*price as applyPrice, 
		(order_quantity*price*0.1) as vat, order_quantity*price+(order_quantity*price*0.1) 
		sumPrice,deadline
		from PMM_PM_ORDER]]>
	<where>
		<if test="startDate != '' and startDate != null">order_date between #{startDate} and #{endDate} </if>
		<if test="endDate != '' and endDate != null">and order_date between #{startDate} and #{endDate} </if>
	</where>

	</select>
	
	<update id="updateOrderClosing">
		<![CDATA[update PMM_PM_ORDER
			set deadline = '마감'
			where sequence=#{sequence}and deadline ='진행']]>
	</update>
	<delete id="delClosing">
		delete from PMM_PM_ORDER where sequence = #{sequence}
	</delete>
	<insert id="insertClosing" parameterType="orderclosingVO">
		<![CDATA[insert into PMM_PM_ORDER
		values(#{sequence},F_GET_NEXT_SEQ('PMM_PM_ORDER'),#{order_date},#{code},#{buyer},#{item_Code},#{item_Name},#{standard},
		#{inventory_unit},#{order_quantity},#{price},#{deadline})
		]]>
	</insert> 
	<update id="updateClosing">
		<![CDATA[update PMM_PM_ORDER
			set order_quantity=#{order_quantity} 
			where item_code=#{item_code}]]>
	</update>
	
	<!-- 품목단가등록(재원) 파트 -->

	<resultMap id="iupView" type="iupVO">
		<result property="no" column="No" />
		<result property="itemNumber" column="Item_Code" />
		<result property="itemName" column="Item_Name" />
		<result property="standard" column="Standard" />
		<result property="inventoryUnit" column="Inventory_Unit" />
		<result property="purchasePrice" column="Purchase_Price" />
		<result property="salesPrice" column="Sales_Price" />
	</resultMap>
	<resultMap id="iupView1" type="iupVO">
		<result property="itemNumber" column="Item_Code" />
		<result property="itemName" column="Item_Name" />
		<result property="standard" column="Standard" />
		<result property="inventoryUnit" column="Inventory_Unit" />
	</resultMap>
	<resultMap id="iupPopView" type="iupVO">
		<result property="itemNumber" column="Item_Code" />
		<result property="itemName" column="Item_Name" />
		<result property="standard" column="Standard" />
	</resultMap>

	<select id="iupSelectAllMemberList" resultMap="iupView">
		<![CDATA[select * from PM_SM_Ite_Pri]]>
	</select>
	<select id="iupSelectNo" resultType="int">
		<![CDATA[select MAX(no) from PM_SM_Ite_Pri]]>
	</select>
	<select id="iupSearchItem" resultMap="iupView" parameterType="String">
		<![CDATA[select * from PM_SM_Ite_Pri where Item_Code = #{itemNumber}]]>
	</select>
	<select id="iupSelectItem1" resultMap="iupView1" parameterType="String">
		<![CDATA[select Item_Code, Item_Name, Standard, Inventory_Unit from SM_BIM_Ite_Reg where Item_Code = #{itemNumber}]]>
	</select>
	<select id="iupSelectPopList1" resultMap="iupPopView">
		<![CDATA[select * from PM_SM_Ite_Pri]]>
	</select>
	<select id="iupSelectPopList2" resultMap="iupPopView">
		<![CDATA[select * from SM_BIM_Ite_Reg]]>
	</select>
	<select id="iupChildView" resultMap="iupView1" parameterType="java.util.HashMap">
		<![CDATA[select * from SM_BIM_Ite_Reg where Item_Code = #{itemNumber}]]>
	</select>
	<insert id="insertIup" parameterType="iupVO">
		<![CDATA[
		 insert into PM_SM_Ite_Pri(No, Item_Code, Item_Name, Standard, Inventory_Unit, Purchase_Price, Sales_Price)
		 values(#{no}, #{itemNumber}, #{itemName}, #{standard}, #{inventoryUnit}, #{purchasePrice}, #{salesPrice})
		]]>  
	</insert>

	<delete id="deleteIup">
		delete from PM_SM_Ite_Pri where No = #{no}
	</delete>
	<update id="updateIup" parameterType="iupVO">
		<![CDATA[
		update PM_SM_Ite_Pri
		set Purchase_Price = #{purchasePrice}, Sales_Price = #{salesPrice}
		where No = #{no}
		]]>
	</update>

	<!-- 외주발주등록 파트 -->
	<!-- <resultMap id="outsourcingView" type="RegOutsourcingVO">
		<result property="workOrderNumber" column="workOrderNumber" />
		<result property="instructionDate" column="instructionDate" />
		<result property="dueDate" column="dueDate" />
		<result property="Item_Code" column="Item_Code" />
		<result property="Item_Name" column="Item_Name" />
		<result property="Standard" column="Standard" />
		<result property="Inventory_Unit" column="Inventory_Unit" />
		<result property="indicatedQuantity" column="indicatedQuantity" />
		<result property="unitPrice" column="unitPrice" />		
		<result property="Price" column="indicatedQuantity*unitPrice" />		
		<result property="status" column="status" />
		<result property="inspection" column="inspection" />
		<result property="note" column="note" />
	</resultMap> -->
	
	
	<!-- <select id="selectAllOutsourcingList" resultMap="outsourcingView">
		<![CDATA[select workOrderNumber,instructionDate,dueDate,Item_Code,Item_Name,Standard,Inventory_Unit,indicatedQuantity,unitPrice,indicatedQuantity*unitPrice,status,inspection,note  from CPM_OM_Out_Per_Reg]]>
	</select>
	
	
	<insert id="insertOutsourcing" parameterType="regOutsourcingVO">
		<![CDATA[insert into CPM_OM_Out_Per_Reg(id,pwd,name,email) values(#{id}, #{pwd}, #{name}, #{email}]]>
	</insert>

	
	<delete id="deleteOutsourcing" parameterType="int">
		<![CDATA[delete from t_member where id=#{id}]]>
	</delete> -->


	<!-- saleplan파트 -->
	<!-- <resultMap id="salesplanResult" type="salesplanVO"> 
			<result property="Plan_Item_Code" column="Plan_Item_Code" /> 
			<result property="Plan_Item_Name" column="Plan_Item_Name" /> 
			<result property="Plan_Item_Unit" column="Plan_Item_Unit" /> 
			<result property="Plan_Item_Quantity" column="Plan_Item_Quantity" /> 
			<result property="Newplan_Item_Quabtity" column="Newplan_Item_Quabtity" /> 
			<result property="Newplan_Item_Unit_Price" column="Newplan_Item_Unit_Price" /> 
			</resultMap> 
			<resultMap id="planItemResult" type="java.util.HashMap"> 
				<result property="Plan_Item_Code" column="Plan_Item_Code" /> 
				<result property="Plan_Item_Name" column="Plan_Item_Name" /> 
				<result property="Plan_Item_Unit" column="Plan_Item_Unit" /> 
				<result property="Plan_Item_Quantity" column="Plan_Item_Quantity" /> 
				<result property="Newplan_Item_Quabtity" column="Newplan_Item_Quabtity" /> 
				<result property="Newplan_Item_Unit_Price" column="Newplan_Item_Unit_Price" />
			 </resultMap> 
		<select id="selectAllSalesplanList" resultMap="salesplanResult"> 
		<![CDATA[ 
			select Plan_Item_Code, Plan_Item_Name, Plan_Item_Unit, Plan_Item_Quantity, 
			Newplan_Item_Quantity, Newplan_Unit_Price from SM_BIM_Sal_Pla_Reg order by 
			Plan_Item_Code desc 
		]]> 
		</select> 
		<insert id="insertSalesplan" parameterType="salesplanVO"> 
		<![CDATA[ insert into SM_BIM_Sal_Pla_Reg(Plan_Date, Plan_Item_Code,Plan_Item_Name,Plan_Item_Unit, 
			Plan_Item_Quantity,Plan_Uint_Price) values(#{Plan_Date}, #{Plan_Item_Code}, 
			#{Plan_Item_Name}, #{Plan_Item_Unit}, #{Plan_Item_Quantity},#{Plan_Uint_Price}) 
		]]>
		 </insert> 
		 <insert id="insertNewSalesplan" parameterType="salesplanVO"> 
		 <![CDATA[ insert into SM_BIM_Sal_Pla_Reg(Newplan_Item_Quantity, Newplan_Unit_Price) 
			values(#{Newplan_Item_Quantity},#{Newplan_Unit_Price}) 
		]]>
		 </insert> 
		 <delete id="deleteSalesplan" parameterType="String"> 
		 <![CDATA[ delete from t_member where Plan_Item_Code=#{Plan_Item_Code} ]]> 
		 </delete> 
		 
		 <select id="loginById" resultType="memberVO" parameterType="memberVO" > 
		 <![CDATA[ select * from t_member where id=#{id} and pwd=#{pwd} ]]> 
		 </select> -->
</mapper>