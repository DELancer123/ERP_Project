<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper
      PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
   "http://mybatis.org/dtd/mybatis-3-mapper.dtd">

<mapper namespace="mappers.erp">
	<resultMap id="SmBimResult"	type="CommitOperationInstructionVO">
		<result property="itemCode" column="Item_Code" />
		<result property="itemName" column="Item_Name" />
		<result property="standard" column="Standard" />
		<result property="inventoryUnit" column="Inventory_Unit" />
		<result property="dailyProduction" column="DailyProduction" />
		<result property="sequence" column="Sequence" />
		<result property="scheduled" column="ScheduledDateOfOperation" />
		<result property="quantity" column="quantity" />
		<result property="note" column="note" />
		<result property="startDate" column="start_Date" />
		<result property="endDate" column="end_Date" />
		<result property="productionPlanCode" column="productionPlanCode" />
	</resultMap>
	<resultMap id="OpePerRegResult" type="OperationRegistVO">
		<result property="workOrderNumber" column="workOrderNumber" />
		<result property="materialstatus" column="MATERIALFORWARDINGSTATUS" />
		<result property="workPlaceCode" column="WORKPLACE_CODE" />
		<result property="instructionDate" column="InstructionDate" />
		<result property="dueDate" column="dueDate" />
		<result property="itemCode" column="Item_Code" />
		<result property="itemName" column="Item_Name" />
		<result property="standard" column="Standard" />
		<result property="inventoryUnit" column="Inventory_Unit" />
		<result property="indicated" column="IndicatedQuantity" />
		<result property="sumPerformanceQuantity" column="performanceQuantity" />
		<result property="remainingPerformance" column="remainingPerformance" />
		<result property="status" column="status" />
		<result property="inspection" column="Inspection" />
		<result property="productionFacility" column="PRODUCTIONFACILITY" />
		<result property="taskTeam" column="taskTeam" />
		<result property="note" column="note" />
		<result property="productionPlanCode" column="ProductionPlanCode" />
	</resultMap>
	<resultMap id="OpePerRegDetResult" type="OperationDetailVO">
		<result property="no" column="NO" />
		<result property="billingDate" column="BILLINGDATE" />
		<result property="itemCode" column="ITEM_CODE" />
		<result property="itemName" column="ITEM_NAME" />
		<result property="standard" column="STANDARD" />
		<result property="inventoryUnit" column="INVENTORY_UNIT" />
		<result property="precisionQuantity" column="PRECISIONQUANTITY" />
		<result property="loss" column="loss" />
		<result property="comfirmQuantity" column="FORWARDINGQUANTITY" />
		<result property="note" column="note" />
		<result property="workOrderNumber" column="workOrderNumber" />
	</resultMap>
	<resultMap id="RegOpePerResult" type="RegistOperationPerformanceVO">
		<result property="workOrderNumber" column="workOrderNumber" />
		<result property="materialstatus" column="MATERIALFORWARDINGSTATUS" />
		<result property="workPlaceCode" column="WORKPLACE_CODE" />
		<result property="instructionDate" column="InstructionDate" />
		<result property="dueDate" column="dueDate" />
		<result property="itemCode" column="Item_Code" />
		<result property="itemName" column="Item_Name" />
		<result property="standard" column="Standard" />
		<result property="inventoryUnit" column="Inventory_Unit" />
		<result property="indicated" column="IndicatedQuantity" />
		<result property="sumPerformanceQuantity" column="performanceQuantity" />
		<result property="remainingPerformance" column="remainingPerformance" />
		<result property="status" column="status" />
		<result property="inspection" column="Inspection" />
		<result property="productionFacility" column="PRODUCTIONFACILITY" />
		<result property="taskTeam" column="taskTeam" />
		<result property="note" column="note" />
		<result property="productionPlanCode" column="ProductionPlanCode" />
	</resultMap>
	<resultMap id="OpeCloDetResult" type="OperationInsClosingVO">
		<result property="OPNumber" column="OPNumber" />
		<result property="instructionDate" column="InstructionDate" />
		<result property="dueDate" column="dueDate" />
		<result property="processCode" column="PROCESS_CODE" />
		<result property="workplaceCode" column="WORKPLACE_CODE" />
		<result property="indicatedQuantity" column="IndicatedQuantity" />
		<result property="sumPerformanceQuantity" column="performanceQuantity" />
		<result property="remainingPerformance" column="remainingPerformance" />
		<result property="unitPrice" column="unitPrice" />
		<result property="price" column="price" />
		<result property="inspection" column="inspection" />
		<result property="note" column="note" />
		<result property="workOrderNumber" column="workOrderNumber" />

		<collection property="OpePerRegDetResult" column="workOrderNumber" select="selectAllOperationRegistDetail"></collection>
		<!--
		<collection property="itemResult" column="itemCode" select="selectitemList"></collection>
		-->
	</resultMap>
	
	<!-- 생산계획 CRUD -->
	<select id="selectAllProductionPlanInfo" resultMap="SmBimResult">
		<![CDATA[select * from CPM_PM_PRO_PLA_REG where Item_Code = #{itemCode}]]>
	</select>
	
	<select id="selectAllProductionPlanInfoCondition" parameterType="CommitOperationInstructionVO" resultMap="SmBimResult">
		<![CDATA[select * from CPM_PM_PRO_PLA_REG]]>
		<where>
			<if test="startDate != '' and startDate != null">
				item_Code = #{itemCode} and SCHEDULEDDATEOFOPERATION between #{startDate} and #{endDate}
			</if>
		</where>
	</select>
	
	<select id="selectAllOperationRegistInfoCondition" parameterType="CommitOperationInstructionVO" resultMap="OpePerRegResult">
		<![CDATA[select * from CPM_PM_Ope_Per_Reg ]]>
		<where>
			<if test="startDate != '' and startDate != null">
				instructionDate between #{startDate} and #{endDate}
			</if>
			<if test="endDate != '' and endDate != null">
				and dueDate between #{startDate} and #{endDate}
			</if>
		</where>
	</select>
	
	<insert id="insertProductionPlan" parameterType="CommitOperationInstructionVO">
		<![CDATA[
		 insert into CPM_PM_PRO_PLA_REG
		 values(F_GET_NEXT_SEQ('CPM_PM_Pro_Pla_Reg'), #{itemCode}, #{itemName}, #{standard}, #{inventoryUnit}, #{dailyProduction}, F_GET_NEXT_SEQ('SEQ'), #{scheduled}, #{quantity}, #{note}, '생산')
		]]>  
	</insert>
	
	<update id="updateProductionPlan" parameterType="CommitOperationInstructionVO">
		<![CDATA[
		update CPM_PM_PRO_PLA_REG
		set SCHEDULEDDATEOFOPERATION = #{scheduled}, quantity = #{quantity}, note = #{note}
		where productionPlanCode = #{productionPlanCode}
		]]>  
	</update>	
	
	<delete id="deleteProductionPlan">
		<![CDATA[delete from CPM_PM_PRO_PLA_REG where productionPlanCode = #{productionPlanCode}]]>
	</delete>
	
	<!-- 작업지시 CURD -->
	<select id="selectAllOperationRegistInfo" parameterType="CommitOperationInstructionVO" resultMap="OpePerRegResult">
		<![CDATA[select * from CPM_PM_Ope_Per_Reg ]]>
	</select>
	<insert id="insertOperationInstruction" parameterType="OperationRegistVO">
		<![CDATA[
		 insert into CPM_PM_OPE_PER_REG
		 values(F_GET_NEXT_SEQ('CPM_PM_Ope_Per_Reg'), '출고대기', 'L101', #{instructionDate}, #{dueDate}, #{itemCode}, #{itemName}, #{standard}, #{inventoryUnit}, #{indicated}, '계획', '비검사', #{note}, #{productionPlanCode}, #{productionFacility}, #{taskTeam})
		]]>  
	</insert>
	<update id="updateOperationInstruction" parameterType="OperationRegistVO">
		<![CDATA[
		update CPM_PM_OPE_PER_REG
		set dueDate = #{dueDate}, indicatedQuantity = #{indicated}, note = #{note}, productionFacility=#{productionFacility}, taskTeam = #{taskTeam}
		where  workOrderNumber = #{workOrderNumber}
		]]>  
	</update>	
	<delete id="deleteOperationInstruction">
		<![CDATA[delete from CPM_PM_OPE_PER_REG where workOrderNumber = #{workOrderNumber}]]>
	</delete>
	
	<!-- 작업지시 확정 CRUD -->
	<select id="selectAllOperationRegistDetail" resultMap="OpePerRegDetResult">
		<![CDATA[select * from CPM_PM_Pro_Mat_For_Det where workOrderNumber = #{number} ]]>
	</select>
	
	<select id="checkConfirmDetail" resultType="string">
		<![CDATA[select status from CPM_PM_Ope_Per_Reg where workOrderNumber = #{workOrderNumber}]]>
	</select>
	
	<update id="updConfirmDetail">
		<![CDATA[
		update CPM_PM_OPE_PER_REG
		set status = '확정'
		where  workOrderNumber = #{workOrderNumber} and status = '계획'
		]]>  
	</update>	
	
	<select id="selectRelease" resultMap="OpePerRegResult">
		<![CDATA[select * from CPM_PM_Ope_Per_Reg where workOrderNumber = #{workOrderNumber]]>
	</select>
	
	<!-- <select id="selectReleaseDetail" resultMap="OpePerRegDetResult">
		<![CDATA[]]>
	</select> -->
	
	<!-- 작업실적등록 CRUD -->
	<select id="selectAllRegistOperationPerformanceInfoDetail" resultType="RegistOperationPerformanceVO">
		<![CDATA[select opr.workordernumber,opr.materialforwardingstatus,func_pro_wor_reg(opr.workplace_code),opr.instructiondate ,opr.duedate,
opr.item_code,opr.item_name,opr.standard,opr.inventory_unit,opr.indicatedquantity, sum(oprd.performancequantity),
(opr.indicatedquantity-sum(oprd.performancequantity)),opr.status,opr.worksortation,opr.inspection,opr.productionfacility,opr.taskteam,opr.note
from CPM_PM_Ope_Per_Reg opr,CPM_PM_Ope_Per_Reg_det oprd
where opr.workordernumber= oprd.workordernumber and  workOrderNumber = #{workOrderNumber}
group by  opr.workordernumber,opr.materialforwardingstatus,opr.workplace_code,opr.instructiondate,opr.duedate,
opr.item_code,opr.item_name,opr.standard,opr.inventory_unit,opr.indicatedquantity,opr.status,opr.worksortation,opr.inspection,opr.productionfacility,opr.taskteam,opr.note
order by opr.workordernumber ]]>
	</select>
	
	<select id="checkMaterialUse" resultType="string">
		<![CDATA[select materialUseStatus from CPM_PM_Ope_Per_Reg_Det where workOrderNumber = #{workOrderNumber}]]>
	</select>
	
	<update id="updMaterialUse">
		<![CDATA[
		update CPM_PM_Ope_Per_Reg_Det
		set materialUseStatus = '유'
		where  workOrderNumber = #{workOrderNumber} and status = '무'
		]]>  
	</update>	
	
		<!-- 기초정보등록 품목등록 -->
		<resultMap id="itemResult" type="itemVO">
		<result property="item_Code" column="Item_Code"	/>
		<result property="item_Name" column="Item_Name"	/>
		<result property="standard" column="Standard"	/>
		<result property="inventory_Unit" column="Inventory_Unit"	/>
		<result property="whether_LOT" column="Whether_LOT"	/>
		<result property="sET_Item" column="SET_Item"	/>
		<result property="inspection_Status" column="Inspection_Status"	/>
		<result property="use_Status" column="Use_Status"	/>
		<result property="lOT_Quantity" column="LOT_Quantity"	/>
		<result property="drawing_Number" column="Drawing_Number"	/>
		<result property="hs_Code" column="Hs_Code"	/>
		<result property="width" column="Width"	/>
		<result property="length" column="Length"	/>
		<result property="height" column="Height"	/>
		<result property="cost" column="Cost"	/>
		<result property="item_Group_Code" column="Item_Group_Code"	/>
		<result property="division" column="Division"	/>
		<result property="notes" column="Notes"	/>
		<result property="daily_production" column="Daily_production"	/>
		</resultMap>
	<!-- 조회 -->
		<select id="selectitemList" resultMap="itemResult">
		<![CDATA[select item_Code,item_Name,standard from SM_BIM_Ite_Reg]]>	
	</select>
	<select id="selectAllitemList" resultMap="itemResult" parameterType="String">
		<![CDATA[select * from SM_BIM_Ite_Reg where item_Code = #{item_Code}]]>	
	</select>
	
	<!-- 작업지시 마감처리 CRUD -->
	<select id="selectAllOperationInsClosingDetail" resultType="OperationInsClosingVO" >
		<![CDATA[select oprd.OPNumber,opr.instructiondate ,opr.duedate,func_pro_reg(oprd.process_code) as processCode,func_pro_wor_reg(oprd.workplace_code) as workplaceCode,opr.indicatedquantity, sum(oprd.performancequantity) as sumPerformancequantity,
(opr.indicatedquantity-sum(oprd.performancequantity)) as remainingPerformance, ir.cost as unitPrice,(opr.indicatedquantity*ir.cost) as price,opr.inspection,opr.note
from CPM_PM_Ope_Per_Reg opr,CPM_PM_Ope_Per_Reg_det oprd,SM_BIM_Ite_Reg ir
where opr.workordernumber= oprd.workordernumber and ir.item_code = opr.item_code and opr.workordernumber=#{workOrderNumber}
group by  oprd.OPNumber,opr.instructiondate,opr.duedate,oprd.process_code,oprd.workplace_code,opr.indicatedquantity, oprd.performancequantity,ir.cost,(opr.indicatedquantity*ir.cost),opr.inspection,opr.note
order by oprd.OPNumber]]>
	</select>
	
	<select id="checkClosingDetail" resultType="string">
		<![CDATA[select status from CPM_PM_Ope_Per_Reg where workOrderNumber = #{workOrderNumber}]]>
	</select>
	
	<update id="updClosingDetail">
		<![CDATA[
		update CPM_PM_OPE_PER_REG
		set status = '마감'
		where  workOrderNumber = #{workOrderNumber} and status = '확정'
		]]>  
	</update>
	
	<update id="updCancleClosingDetail">
		<![CDATA[
		update CPM_PM_OPE_PER_REG
		set status = '확정'
		where  workOrderNumber = #{workOrderNumber} and status = '마감'
		]]>  
	</update>	
	
	<!-- 생산 팝업 파트 -->	
	<resultMap id="ItemCodeResult" type="ItemCodePopVO">
		<result property="itemCode" column="Item_Code" />
		<result property="itemName" column="Item_Name" />
		<result property="inventoryUnit" column="inventory_Unit" />
		<result property="dailyProduction" column="dailyProduction" />
	</resultMap>
	<select id="selectItemCodeView" resultMap="ItemCodeResult">
		<![CDATA[select * from SM_BIM_Ite_Reg where Division in ('완제품', '반제품')]]>
	</select>
	<resultMap id="FactoryViewResult" type="FactoryViewVO">
		<result property="workplaceCode" column="workplace_Code" />
		<result property="workplaceName" column="workplace_Name" />
	</resultMap>
	<select id="selectFactoryList" resultMap="FactoryViewResult">
		<![CDATA[select * from SM_CRI_Wor_Reg]]>
	</select>
	<resultMap id="DepartmentViewResult" type="DepartmentViewVO">
		<result property="departmentCode" column="department_Code" />
		<result property="departmentName" column="department_Name" />
	</resultMap>
	<select id="selectDepartmentList" resultMap="DepartmentViewResult">
		<![CDATA[select* from SM_CRI_Dep_Reg]]>
	</select>
	<resultMap id="selectProductionPlanViewResult" type="ProductionPalnViewVO">
		<result property="productionPlanCode" column="ProductionPlanCode" />
		<result property="itemCode" column="item_code" />
		<result property="itemName" column="item_Name" />
		<result property="standard" column="standard" />
		<result property="inventoryUnit" column="inventory_unit" />
		<result property="dailyProduction" column="dailyProduction" />
		<result property="sequence" column="sequence" />
		<result property="schedule" column="scheduleddateofoperation" />
		<result property="quantity" column="quantity" />
		<result property="note" column="note" />
	</resultMap>
	<select id="selectProductionPlanList" parameterType="CommitOperationInstructionVO" resultMap="selectProductionPlanViewResult">
		<![CDATA[select * from CPM_PM_Pro_Pla_Reg where scheduleddateofoperation between #{startDate} and #{endDate}]]>
	</select>
	
	<!-- BOM 파트 -->
	<resultMap id="bomView" type="bomVO">
		<result property="no" column="no" />
		<result property="parent" column = "parent_item_code"/>
		<result property="itemNumber" column="item_code" />
		<result property="itemName" column="item_name" />
		<result property="standard" column="standard" />
		<result property="unit" column="inventory_unit" />
		<result property="precisionQuantity" column="precisionQuantity" />
		<result property="loss" column="loss" />
		<result property="division" column="division" />
		<result property="cost" column="cost"/>
	</resultMap>
	<resultMap id="popView" type="bomVO">
		<result property="itemNumber" column="item_code" />
		<result property="itemName" column="item_name" />
		<result property="standard" column="standard" />
	</resultMap>
	<resultMap id="outpopView" type="bomVO">
		<result property="itemNumber" column="outSourcing_code" />
		<result property="itemName" column="outsourcing_name" />
	</resultMap>
	<resultMap id="outpopViewex" type="bomVO">
		<result property="itemNumber" column="Workplace_Code" />
		<result property="itemName" column="Workplace_Name" />
	</resultMap>
	
	<select id="selectAllMemberList" resultMap="bomView">
		<![CDATA[select * from CPM_BIM_BOM_REG]]>
	</select>
	<select id="selectNo" resultType="int">
		<![CDATA[select MAX(no) from CPM_BIM_BOM_REG]]>
	</select>
	<select id="searchitem" resultMap="bomView"
		parameterType="String">
		<![CDATA[select * from CPM_BIM_BOM_REG where parent_item_code = #{parent}]]>
	</select>
	<select id="selectitem" resultMap="bomView"
		parameterType="String">
		<![CDATA[select item_code,item_name,standard,inventory_unit,division,COST from SM_BIM_Ite_Reg where item_code=#{itemNumber}]]>
	</select>
	<select id="inputItem" resultMap="bomView"
		parameterType="String">
		<![CDATA[select no,item_code,item_name,standard,inventory_unit,COST from cpm_bim_bom_reg where item_code=#{itemNumber}]]>
	</select>
	<select id="selectPopList1" resultMap="popView">
		<![CDATA[select * from SM_BIM_Ite_Reg where not division='부품']]>
	</select>
	<select id="selectPopList2" resultMap="popView">
		<![CDATA[select * from SM_BIM_Ite_Reg where not division = '완제품']]>
	</select>
	<select id="childView" resultMap="bomView" parameterType="java.util.HashMap">
		<![CDATA[select bom.* from (select parent_item_code, item_code,item_name from cpm_bim_bom_reg where parent_item_code =#{0}) pc, (select * from cpm_bim_bom_reg) bom where pc.item_code = bom.parent_item_code and pc.item_name=#{1}]]>
	</select>
	<insert id="insertBOM" parameterType="bomVO">
		<![CDATA[
		 insert into CPM_BIM_BOM_REG(NO,PARENT_ITEM_CODE,ITEM_CODE,ITEM_NAME,STANDARD,INVENTORY_UNIT,PRECISIONQUANTITY,LOSS,DIVISION)
		 values(#{no},#{parent}, #{itemNumber}, #{itemName}, #{standard}, #{unit}, #{precisionQuantity}, #{loss}, #{division})
		]]>  
	</insert>

	<delete id="deleteBOM">
		delete from CPM_BIM_BOM_REG where NO = #{no}
	</delete>
 
	<update id="updateBOM" parameterType="bomVO">
		<![CDATA[
		update CPM_BIM_BOM_REG
		set Item_Name=#{itemName}, Standard=#{standard}, Inventory_Unit=#{unit},precisionQuantity=#{precisionQuantity}, loss=#{loss}, division=#{division}
		where  no=#{no}
		]]>  
	</update>
	<select id="outView" resultMap="outpopView">
		<![CDATA[select outsourcing_code,outsourcing_name from sm_bim_out_reg]]>
	</select>
	<select id="outViewex" resultMap="outpopViewex" parameterType="String">
		<![CDATA[select workplace_code,workplace_name from sm_bim_out_wor_reg]]>
	</select>
	
	
	<!-- 외주단가등록 -->
	<resultMap id="outpriView" type="outpriVO">
		<result property="outsourcing_Code" column="OUTSOURCING_CODE" />
		<result property="outcustomer" column = "OUTCUSTOMER"/>
		<result property="item_code" column="ITEM_CODE" />
		<result property="outprice" column="OUTSOURCINGUNITPRICE" />
		<result property="startDate" column="STARTDATE" />
		<result property="endDate" column="ENDDATE" />
		<collection property="bomVO" resultMap="bomView"></collection>
	</resultMap>
	
	<select id="outpriceView" resultMap="outpriView" parameterType="java.util.HashMap">
		<![CDATA[select out.*, ite.item_name,ite.STANDARD,ite.INVENTORY_UNIT,ite.COST
from cpm_bim_out_pri out, sm_bim_ite_reg ite
where out.item_code = ite.item_code and out.outsourcing_code = #{0} and out.outcustomer=#{1}]]>
	</select>
	<insert id="addoutprice" parameterType="outpriVO">
		<![CDATA[
		 insert into CPM_BIM_OUT_PRI
		 values(#{outsourcing_Code},#{outcustomer}, #{item_code}, #{outprice}, #{startDate}, #{endDate})
		]]>  
	</insert>
	<update id="udpoutprice" parameterType="outpriVO">
		<![CDATA[
		update CPM_BIM_OUT_PRI
		set OUTSOURCINGUNITPRICE = #{outprice}, STARTDATE=#{startDate},ENDDATE=#{endDate}
		where  outsourcing_Code=#{outsourcing_Code} and outcustomer=#{outcustomer} and item_code=#{item_code}
		]]>  
	</update>
	<delete id="deloutprice" parameterType="outpriVO">
		delete from CPM_BIM_OUT_PRI where  outsourcing_Code=#{outsourcing_Code} and outcustomer=#{outcustomer} and item_code=#{item_code}
	</delete>
	<!-- 불량유형등록 -->
	<resultMap id="defTypeView" type="defVO">
		<result property="defectCode" column="DEFECTCODE" />
		<result property="defectiveTypeName" column = "DEFECTIVETYPENAME"/>
		<result property="defectiveItemGroupCode" column="DEFECTIVEITEMGROUPCODE" />
		<result property="defectiveItemGroup" column="DEFECTIVEITEMGROUP" />
		<result property="usageStatus" column="USAGESTATUS" />
		<result property="defectiveDescription" column="DEFECTIVEDESCRIPTION" />
	</resultMap>
	<resultMap id="defGroupView" type="defVO">
		<result property="defectiveItemGroupCode" column="DEFECTIVETYPENAME" />
		<result property="defectiveItemGroup" column="DEFECTIVEITEMGROUPCODE" />
	</resultMap>
	<select id="defectiveView" resultMap="defTypeView" parameterType="String">
		<![CDATA[select * from cpm_bim_def_typ_reg where DEFECTIVEITEMGROUPCODE=#{defGroupCode}]]>
	</select>
	<insert id="addDefType" parameterType="defVO">
		<![CDATA[
		 insert into cpm_bim_def_typ_reg
		 values(#{defectCode},#{defectiveTypeName}, #{defectiveItemGroupCode}, #{defectiveItemGroup}, #{usageStatus}, #{defectiveDescription})
		]]>  
	</insert>
	<update id="updDefType" parameterType="defVO">
		<![CDATA[
		update cpm_bim_def_typ_reg
		set DEFECTCODE = #{defectCode}, DEFECTIVETYPENAME=#{defectiveTypeName},DEFECTIVEITEMGROUPCODE=#{defectiveItemGroupCode},DEFECTIVEITEMGROUP=#{defectiveItemGroup},USAGESTATUS=#{usageStatus},DEFECTIVEDESCRIPTION=#{defectiveDescription}
		where DEFECTCODE=#{oridefectCode}
		]]>  
	</update>
	<select id="defGroupView" resultMap="defGroupView" >
		<![CDATA[select * from cpm_bim_def_group]]>
	</select>
	<insert id="addDefpop" parameterType="defVO">
		<![CDATA[
		 insert into cpm_bim_def_group
		 values(#{defectiveItemGroupCode}, #{defectiveItemGroup})
		]]>  
	</insert>
	<!-- mainPaln 파트 -->
	<resultMap id="mainplanResult" type="mainplanVO">
		<result property="plandate" column="plandate" />
		<result property="item_Code" column="item_Code" />
		<result property="item_Name" column="item_Name" />
		<result property="standard" column="standard" />
		<result property="unit" column="unit" />
		<result property="sequence" column="sequence" />
		<result property="expected_date" column="expected_date" />
		<result property="due_date" column="due_date" />
		<result property="plan_quantity" column="plan_quantity" />
		<result property="customer_name" column="customer_name" />
		<result property="note" column="note" />
	</resultMap>
	<resultMap type="mpsosVO" id="MpsOSResult">
		<result column="ordersno" property="ordersno" />
		<result column="sequence" property="sequence" />
		<result column="orderdate" property="orderdate" />
		<result column="okeydate" property="okeydate" />
		<result column="customer_name" property="customer_name" />
		<result column="item_Code" property="item_Code" />
		<result column="item_Name" property="item_Name" />
		<result column="standard" property="standard" />
		<result column="unit" property="unit" />
		<result column="order_quantity" property="order_quantity" />
		<result column="apply_quantity" property="apply_quantity" />
		<result column="order_Balance" property="order_Balance" />
		<result column="expected_Date" property="expected_Date" />
		<result column="note" property="note" />
	</resultMap>

	<select id="selectAllMainPlanList" resultMap="mainplanResult">
		<![CDATA[SELECT * from pmm_pm_mps]]>
	</select>
	<select id="selectAllMpsosList" resultMap="MpsOSResult">
		<![CDATA[SELECT * from pmm_pm_mps_os]]>
	</select>

	<!-- billing파트 -->
	<resultMap id="billingResult" type="billingVO">
		<result property="claim_no" column="claim_no" />
		<result property="claim_date" column="claim_date" />
		<result property="claim_division" column="claim_division" />
		<result property="note" column="note" />
	</resultMap>
	<resultMap id="ListResult" type="listVO">
		<result column="sequence" property="sequence" />
		<result column="item_Code" property="item_Code" />
		<result column="item_Name" property="item_Name" />
		<result column="standard" property="standard" />
		<result column="requestdate" property="requestdate" />
		<result column="inventory_unit" property="inventory_unit" />
		<result column="inventory_qy" property="inventory_qy" />
		<result column="claim_unit" property="claim_unit" />
		<result column="claim_quantity" property="claim_quantity" />
		<result column="customer_name" property="customer_name" />		
	</resultMap>
	<resultMap id="mrpamountResult" type="requiredamountVO">
		<result property="need_date" column="need_date" />
		<result property="expected_order" column="expected_order" />
		<result property="item_Code" column="item_Code" />
		<result property="item_Name" column="item_Name" />
		<result property="standard" column="standard" />
		<result property="unit" column="unit" />
		<result property="expected_quantity" column="expected_quantity" />
	</resultMap>

	<select id="selectAllcmList" resultMap="billingResult">
		<![CDATA[SELECT * from PMM_PM_CM]]>
	</select>
	
	<select id="selectAllBottomList" resultMap="ListResult">
		<![CDATA[select * from pmm_pm_cm_list]]>
	</select>
	
	<select id="selectAllMrpaMount" resultMap="mrpamountResult">
		<![CDATA[select need_date,expected_order,item_Code,item_Name,standard,unit,expected_quantity
			from pmm_pm_mrp]]>
	</select>
	
	

	<!-- mrp파트 -->
	<resultMap id="mrpResult" type="requiredamountVO">
		<result property="item_Code" column="item_Code" />
		<result property="item_Name" column="item_Name" />
		<result property="standard" column="standard" />
		<result property="need_date" column="need_date" />
		<result property="sequence" column="sequence" />
		<result property="expected_order" column="expected_order" />
		<result property="expected_quantity" column="expected_quantity" />
		<result property="unit" column="unit" />
	</resultMap>

	<select id="selectAllMrpList" resultMap="mrpResult">
		<![CDATA[SELECT * from pmm_pm_mrp]]>
	</select>
	
	<!-- 품목단가등록파트 재원-->
	<!-- <resultMap id="itemView" type="itemVO">
		<result property="Item_Code" column="Item_Code" /> 품번
		<result property="Item_Name" column="Item_Name" /> 품명
		<result property="Standard" column="Standard" /> 규격
		<result property="Inventory_Unit" column="Inventory_Unit" /> 단위
		<result property="Kind" column="Kind" /> 종류(구매단가,판매단가)
		<result property="Purchase_Price" column="Purchase_Price" /> 구매단가
		<result property="Sales_Price" column="Sales_Price" /> 판매단가, 구매단가입력시 Null
	</resultMap>
	<resultMap id="popView" type="itemVO">
		<result property="Item_Code" column="Item_Code" />
		<result property="Item_Name" column="Item_Name" />
		<result property="standard" column="standard" />
	</resultMap>

	<select id="selectAllMemberList" resultMap="itemView">
		<![CDATA[select * from CPM_BIM_BOM_REG]]>
	</select>
	<select id="searchitem" resultMap="itemView"
		parameterType="String">
		<![CDATA[select * from CPM_BIM_BOM_REG where item_code = #{itemNumber}]]>
	</select>
	<select id="selectitem" resultMap="itemView"
		parameterType="String">
		<![CDATA[select item_code,item_name,standard,inventory_unit from CPM_BIM_BOM_REG where item_code=#{itemNumber}]]>
	</select>
	<select id="selectPopList" resultMap="popView">
		<![CDATA[select * from CPM_BIM_BOM_REG]]>
	</select>
	<insert id="insertItem" parameterType="itemVO">
		<![CDATA[
		 insert into CPM_BIM_BOM_REG
		 values(#{no}, #{itemNumber}, #{itemName}, #{standard}, #{unit}, #{precisionQuantity}, #{loss}, #{actualQuantity}, #{actualCost}, #{outSourcingUnitPrice}, #{startDate}, #{endDate}, #{note})
		]]>  
	</insert>
	<update id="updateItem" parameterType="itemVO">
		<![CDATA[
		update CPM_BIM_BOM_REG
		set item_name=#{itemName}, standard=#{standard}, inventory_unit=#{unit}
		where  item_code=#{itemNumber}
		]]>  
	</update> -->
	
	<!-- 외주발주등록 파트 -->
<resultMap id="outsourcingView" type="RegOutsourcingVO">
		<result property="workOrderNumber" column="workOrderNumber" />
		<result property="instructionDate" column="instructionDate" />
		<result property="dueDate" column="dueDate" />
		<result property="itemCode" column="Item_Code" />
		<result property="itemName" column="Item_Name" />
		<result property="standard" column="Standard" />
		<result property="inventoryUnit" column="Inventory_Unit" />
		<result property="indicatedQuantity" column="indicatedQuantity" />
		<result property="unitPrice" column="unitPrice" />				
		<result property="status" column="status" />
		<result property="inspection" column="inspection" />
		<result property="note" column="note" />		
		<result property="productionPlanCode" column="ProductionPlanCode" />
		
	</resultMap>
	
	<select id="selectAllOutsourcingList" resultMap="outsourcingView">
		<![CDATA[select workOrderNumber,instructionDate,dueDate,Item_Code,Item_Name,Standard,Inventory_Unit,indicatedQuantity,unitPrice,indicatedQuantity*unitPrice,status,inspection,note,ProductionPlanCode  from CPM_OM_Out_Per_Reg]]>
	</select>
	
	
	<delete id="deleteOutsourcing">
		<![CDATA[delete from CPM_OM_Out_Per_Reg where workOrderNumber=#{workOrderNumber}]]>
	</delete>

	<insert id="insertOutsourcing" parameterType="RegOutsourcingVO">
		<![CDATA[
		 insert into CPM_OM_Out_Per_Reg
		 values(F_GET_NEXT_SEQ('CPM_PM_Ope_Per_Reg'),'출고대기','P101',#{instructionDate}, #{dueDate}, #{itemCode}, #{itemName}, #{standard}, #{inventoryUnit}, #{indicatedQuantity}, #{unitPrice},'계획', '비검사', #{note},F_GET_NEXT_SEQ('CPM_PM_Pro_Pla_Reg'))
		]]>  
	</insert>
	
	<update id="updateOutsourcing" parameterType="RegOutsourcingVO">
		<![CDATA[
		update CPM_OM_Out_Per_Reg
		set dueDate=#{dueDate},indicatedQuantity=#{indicatedQuantity}, unitPrice=#{unitPrice}, note=#{note}
		where  workOrderNumber=#{workOrderNumber}
		]]>  
	</update>


	<!-- 외주발주확정 파트 -->
	<resultMap id="comOutsourcingView" type="ComOutsourcingVO">
		<result property="workOrderNumber" column="workOrderNumber" />
		<result property="materialForwardingStatus" column="materialForwardingStatus" />
		<result property="instructionDate" column="instructionDate" />
		<result property="dueDate" column="dueDate" />
		<result property="parentItemCode" column="Item_Code" />
		<result property="parentItemName" column="Item_Name" />
		<result property="parentStandard" column="Standard" />
		<result property="parentInventoryUnit" column="Inventory_Unit" />
		<result property="unitPrice" column="unitPrice" />				
		<result property="status" column="status" />
		<result property="inspection" column="inspection" />
		<result property="parentNote" column="note" />		
	</resultMap>

		<update id="updateComOutsourcing" parameterType="ComOutsourcingVO">
		<![CDATA[
		update CPM_OM_Out_Per_Reg
		set status = '확정'
		where  workOrderNumber=#{workOrderNumber}
		]]>  
	</update>
	
	<select id="selectAllComOutsourcingList" resultMap="comOutsourcingView">
		<![CDATA[select workOrderNumber,materialForwardingStatus,instructionDate,dueDate,Item_Code,Item_Name,Standard,Inventory_Unit,indicatedQuantity,unitPrice,indicatedQuantity*unitPrice,status,inspection,note  from CPM_OM_Out_Per_Reg]]>
	</select>
	
	<!-- 외주발주확정 세부사항 파트 -->
	<resultMap id="comOutsourcingViewDetail" type="ComOutsourcingVO">
		<result property="no" column="no" />
		<result property="billingDate" column="billingDate" />
		<result property="itemCode" column="Item_Code" />
		<result property="itemName" column="Item_Name" />
		<result property="standard" column="Standard" />
		<result property="inventoryUnit" column="Inventory_Unit" />
		<result property="precisionQuantity" column="precisionQuantity" />
		<result property="loss" column="loss" />				
		<result property="note" column="note" />
		<collection property="bomView" column="itemCode" select="selectAllMemberList"></collection>
	</resultMap>
	
	<select id="selectComOutsourcingListDetail" resultMap="comOutsourcingViewDetail">
		<![CDATA[select DISTINCT(mat.workordernumber),OUT.Item_Code,OUT.billingDate,OUT.Item_Name,OUT.Standard,OUT.Inventory_Unit,OUT.precisionQuantity,OUT.loss,OUT.precisionQuantity+(OUT.precisionQuantity*OUT.loss*0.01) as 확정수량,bom.outsourcingunitprice as 외주단가,
(OUT.precisionQuantity+(OUT.precisionQuantity*OUT.loss*0.01))*bom.outsourcingunitprice as 금액 ,OUT.note  
from CPM_OM_Out_Mat_For_Det OUT,cpm_bim_bom_reg BOM,CPM_OM_Out_Per_Reg MAT
where out.item_code=bom.item_code
AND mat.workordernumber=out.workordernumber
order by workordernumber]]>
	</select>
	
	<!-- 외주자재출고 파트 -->
	<resultMap id="outReleaseView" type="OutReleaseVO">
		<result property="forwardingNumber" column="forwardingNumber" />
		<result property="forwardingDate" column="forwardingDate" />
		<result property="houseCode" column="func_hou_reg(House_Code)" />
		<result property="locationCode" column="func_Wor_Reg(Location_Code)" />
		<result property="outsourcingCode" column="func_Out_Reg(Outsourcing_Code)" />
		<result property="workplaceCode" column="func_Out_Wor_Reg(Workplace_Code)" />
		<result property="note" column="note" />	
	</resultMap>

	<select id="selectAllOutReleaseList" resultMap="outReleaseView">
		<![CDATA[select forwardingNumber,forwardingDate,func_hou_reg(House_Code),func_Wor_Reg(Location_Code),func_Out_Reg(Outsourcing_Code),func_Out_Wor_Reg(Workplace_Code),note  from CPM_OM_Out_Mat_For]]>
	</select>
	
	<insert id="insertOutRelease" parameterType="OutReleaseVO">
		<![CDATA[
		INSERT INTO CPM_OM_Out_Mat_For
		VALUES (F_GET_NEXT_SEQ('PM_SM_Sto_Mov_Main'),#{forwardingDate}, #{houseCode}, #{locationCode}, #{outsourcingCode}, #{workplaceCode},#{note});
		]]>  
	</insert>

	
	<!-- 외주자재출고 세부사항 파트 -->
	<resultMap id="outReleaseViewDetail" type="OutReleaseVO">
		<result property="no" column="no" />
		<result property="itemCode" column="Item_Code" />
		<result property="itemName" column="Item_Name" />
		<result property="standard" column="Standard" />
		<result property="inventoryUnit" column="Inventory_Unit" />
		<result property="precisionQuantity" column="precisionQuantity" />
		<result property="forwardingQuantity" column="forwardingQuantity" />				
		<result property="noteDetail" column="note" />
		<result property="forwardingNumber" column="forwardingNumber" />
		<result property="workOrderNumber" column="workOrderNumber" />
		<collection property="comOutsourcingView" column="workOrderNumber" select="selectAllMemberList"></collection>
	</resultMap>
	
	<select id="selectAllOutReleaseListDetail" resultMap="outReleaseViewDetail">
		<![CDATA[SELECT NO,ITEM_CODE,ITEM_NAME,STANDARD,INVENTORY_UNIT,PRECISIONQUANTITY,FORWARDINGQUANTITY
FROM CPM_OM_Out_Mat_For MAT, CPM_OM_Out_Mat_For_Det MAF
WHERE MAT.FORWARDINGNUMBER = maf.forwardingnumber]]>
	</select>
	
	<insert id="insertOutReleaseDetail" parameterType="OutReleaseVO">
		<![CDATA[
		INSERT INTO CPM_OM_Out_Mat_For_Det
		VALUES (F_GET_NEXT_SEQ('NO'),#{billingDate}, #{itemCode}, #{itemName}, #{standard}, #{inventoryUnit},#{precisionQuantity},#{loss},#{forwardingQuantity},#{noteDetail},#{forwardingNumber},#{workOrderNumber});
		]]>  
	</insert>
	
		<!-- 외주실적등록 파트 -->
	<resultMap id="regOutPerformanceView" type="RegOutPerformanceVO">
		<result property="workOrderNumber" column="workOrderNumber" />
		<result property="materialForwardingStatus" column="materialForwardingStatus" />
		<result property="workplaceCode" column="workplaceCode" />
		<result property="instructionDate" column="instructionDate" />
		<result property="dueDate" column="dueDate" />
		<result property="parentItemCode" column="Item_Code" />
		<result property="parentItemName" column="Item_Name" />
		<result property="parentStandard" column="Standard" />
		<result property="parentInventoryUnit" column="Inventory_Unit" />
		<result property="indicatedQuantity" column="indicatedQuantity" />
		<result property="unitPrice" column="unitPrice" />							
		<result property="status" column="status" />
		<result property="parentInspection" column="inspection" />
		<result property="parentNote" column="note" />		
	</resultMap>

	<select id="selectAllRegOutPerformanceList" resultMap="regOutPerformanceView">
		<![CDATA[select distinct(out.workordernumber),out.materialforwardingstatus,func_out_wor_reg(out.workplace_code),out.instructiondate,out.duedate,out.item_code,out.item_name,out.standard,out.inventory_unit,
out.indicatedquantity,out.unitprice,(out.indicatedquantity*out.unitprice),sum(det.performancequantity),(out.indicatedquantity-sum(det.performancequantity)),out.status,out.inspection,out.note
from CPM_OM_Out_Per_Reg out, CPM_OM_Out_Per_Reg_Det det
where out.workordernumber= det.workordernumber
group by out.workordernumber,out.materialforwardingstatus,func_out_wor_reg(out.workplace_code),out.instructiondate,out.duedate,out.item_code,out.item_name,out.standard,out.inventory_unit,
out.indicatedquantity,out.unitprice,(out.indicatedquantity*out.unitprice),out.status,out.inspection,out.note
ORDER BY out.workordernumber]]>
	</select>
	
	<!-- 외주실적등록 세부사항 파트 -->
	<resultMap id="regOutPerformanceViewDetail" type="RegOutPerformanceVO">
		<result property="operationPerformanceNumber" column="operationPerformanceNumber" />
		<result property="materialUseStatus" column="materialUseStatus" />
		<result property="performanceDate" column="performanceDate" />
		<result property="outsourcingCode" column="func_Out_Reg(Outsourcing_Code)" />
		<result property="workplaceCode" column="func_Out_Wor_Reg(Workplace_Code)" />
		<result property="sortation" column="sortation" />
		<result property="performanceQuantity" column="performanceQuantity" />				
		<result property="inspection" column="inspection" />
		<result property="note" column="note" />
		<result property="workOrderNumber" column="workOrderNumber" />
	</resultMap>
	
	<select id="selectAllRegOutPerformanceDetail" resultMap="regOutPerformanceViewDetail">
		<![CDATA[SELECT operationPerformanceNumber,materialUseStatus,performanceDate,func_Out_Reg(Outsourcing_Code),func_Out_Wor_Reg(Workplace_Code),
		sortation,performanceQuantity,inspection,note
		 FROM CPM_OM_Out_Per_Reg_Det]]>
	</select>
	

</mapper>


































